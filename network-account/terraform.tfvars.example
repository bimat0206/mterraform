# -----------------------------------------------------------------------------
# Example Terraform variables for Network Account
# Copy this file to dev.tfvars or prod.tfvars and customize values
# Usage: terraform plan -var-file=dev.tfvars
# -----------------------------------------------------------------------------

# -----------------------------------------------------------------------------
# General configuration
# -----------------------------------------------------------------------------
region = "ap-southeast-1" # AWS region

# -----------------------------------------------------------------------------
# Naming convention
# -----------------------------------------------------------------------------
org_prefix  = "tsk"  # Organization prefix (e.g., company abbreviation)
environment = "dev"  # Environment: dev, prod, staging, etc.
workload    = "app"  # Workload type: app, platform, data, etc.

# -----------------------------------------------------------------------------
# Tagging
# Standard tags applied to all resources via module tags + provider default_tags
# -----------------------------------------------------------------------------
tags = {
  owner       = "cloud-platform"  # Team or individual owner
  cost-center = "CC-1234"         # Cost allocation code
  project     = "landing-zone"    # Project name
  environment = "dev"             # Environment (redundant with provider default_tags but useful)
}

# -----------------------------------------------------------------------------
# VPC Configuration - Basic
# -----------------------------------------------------------------------------
vpc_cidr_block = "10.0.0.0/16" # Primary VPC CIDR block
vpc_az_count   = 2              # Number of Availability Zones (1-6)

# -----------------------------------------------------------------------------
# VPC Configuration - Advanced (Optional)
# Uncomment to enable additional VPC features
# -----------------------------------------------------------------------------

# Secondary CIDR blocks (for VPC expansion)
# vpc_secondary_cidr_blocks = ["10.1.0.0/16", "10.2.0.0/16"]

# IPv6 support
# vpc_enable_ipv6 = true

# Instance tenancy (default or dedicated)
# vpc_instance_tenancy = "default"

# DNS settings
# vpc_enable_dns_hostnames = true
# vpc_enable_dns_support   = true

# -----------------------------------------------------------------------------
# Subnet Configuration
# -----------------------------------------------------------------------------

# Database subnets (creates additional isolated subnets)
# vpc_create_database_subnets      = true
# vpc_create_database_subnet_group = true  # Auto-create RDS subnet group

# Customize subnet naming
# vpc_public_subnet_suffix   = "public"
# vpc_private_subnet_suffix  = "private"
# vpc_database_subnet_suffix = "database"

# Public IP assignment
# vpc_map_public_ip_on_launch = true

# -----------------------------------------------------------------------------
# NAT Gateway Configuration
# -----------------------------------------------------------------------------
vpc_enable_nat_gateway = true # Enable NAT Gateway for private subnet internet access

# NAT Gateway deployment strategy (choose one):
# 1. Single NAT Gateway (Cost-optimized for dev/test)
# vpc_single_nat_gateway = true  # ~$32/month
# vpc_one_nat_gateway_per_az = false

# 2. NAT Gateway per AZ (High availability for production)
# vpc_single_nat_gateway = false  # ~$96/month for 3 AZs
# vpc_one_nat_gateway_per_az = true

# 3. No NAT Gateway (Fully private VPC with VPC endpoints only)
# vpc_enable_nat_gateway = false

# -----------------------------------------------------------------------------
# VPN Gateway Configuration
# -----------------------------------------------------------------------------
# vpc_enable_vpn_gateway = true
# vpc_vpn_gateway_az     = null  # Specific AZ or null for AWS-selected
# vpc_propagate_vpn_routes_to_private_route_tables = true
# vpc_propagate_vpn_routes_to_public_route_tables  = false

# -----------------------------------------------------------------------------
# VPC Flow Logs Configuration
# -----------------------------------------------------------------------------
# vpc_enable_flow_logs = true
# vpc_flow_logs_destination_type = "cloud-watch-logs"  # or "s3"
# vpc_flow_logs_destination_arn  = ""  # Leave empty for auto-created CloudWatch log group
# vpc_flow_logs_traffic_type     = "ALL"  # ACCEPT, REJECT, or ALL
# vpc_flow_logs_retention_days   = 7  # CloudWatch log retention

# -----------------------------------------------------------------------------
# VPC Gateway Endpoints Configuration (Separate Module)
# Gateway endpoints are FREE - no hourly or data charges
# -----------------------------------------------------------------------------

# Enable the gateway endpoints module
# vpce_gateway_enabled = true

# Gateway Endpoints (FREE - recommended for S3 and DynamoDB)
# vpce_enable_s3_endpoint       = true
# vpce_enable_dynamodb_endpoint = true

# -----------------------------------------------------------------------------
# VPC Interface Endpoints Configuration (Separate Module)
# Interface endpoints cost ~$7.20/month each + data transfer (~$0.01/GB)
# -----------------------------------------------------------------------------

# Enable the interface endpoints module
# vpce_interface_enabled = true

# Interface Endpoints - Select services you need
# vpce_interface_endpoints = {
#   ec2         = true  # EC2 API
#   ssm         = true  # Systems Manager
#   ssmmessages = true  # SSM Session Manager
#   ec2messages = true  # SSM for EC2
#   kms         = true  # KMS
#   logs        = true  # CloudWatch Logs
#   sts         = true  # STS
#   secretsmanager = true  # Secrets Manager
#   ecr.api     = true  # ECR API
#   ecr.dkr     = true  # ECR Docker
# }

# Enable private DNS for interface endpoints (recommended)
# vpce_private_dns_enabled = true

# -----------------------------------------------------------------------------
# DHCP Options Configuration
# -----------------------------------------------------------------------------
# vpc_enable_dhcp_options              = true
# vpc_dhcp_options_domain_name         = "example.internal"
# vpc_dhcp_options_domain_name_servers = ["AmazonProvidedDNS"]
# vpc_dhcp_options_ntp_servers         = ["169.254.169.123"]
# vpc_dhcp_options_netbios_name_servers = []
# vpc_dhcp_options_netbios_node_type   = 2

# -----------------------------------------------------------------------------
# Network ACL Configuration
# -----------------------------------------------------------------------------
# vpc_public_dedicated_network_acl  = true  # Create dedicated NACL for public subnets
# vpc_private_dedicated_network_acl = true  # Create dedicated NACL for private subnets

# Manage default NACL (lock it down)
# vpc_manage_default_network_acl = true
# vpc_default_network_acl_ingress = [
#   {
#     rule_no    = 100
#     action     = "deny"
#     protocol   = "-1"
#     cidr_block = "0.0.0.0/0"
#     from_port  = 0
#     to_port    = 0
#   }
# ]
# vpc_default_network_acl_egress = [
#   {
#     rule_no    = 100
#     action     = "deny"
#     protocol   = "-1"
#     cidr_block = "0.0.0.0/0"
#     from_port  = 0
#     to_port    = 0
#   }
# ]

# -----------------------------------------------------------------------------
# Default Security Group Configuration
# -----------------------------------------------------------------------------
# Lock down default security group (security best practice)
# vpc_manage_default_security_group = true
# vpc_default_security_group_ingress = []  # No ingress
# vpc_default_security_group_egress  = []  # No egress

# -----------------------------------------------------------------------------
# Default Route Table Configuration
# -----------------------------------------------------------------------------
# vpc_manage_default_route_table = true
# vpc_default_route_table_routes = []

# -----------------------------------------------------------------------------
# ACM Configuration (Optional)
# Set acm_enabled = true to create ACM certificate
# -----------------------------------------------------------------------------
acm_enabled = false # Set to true to enable ACM certificate creation

# Uncomment and configure if acm_enabled = true
# acm_domain_name               = "example.com"
# acm_subject_alternative_names = ["*.example.com", "www.example.com"]
# acm_hosted_zone_id            = "Z1234567890ABC" # Route53 hosted zone ID

# -----------------------------------------------------------------------------
# ALB Configuration (Optional)
# Set alb_enabled = true to create Application Load Balancer
# Cost: ~$22.50/month + data processing (~$0.008/GB)
# -----------------------------------------------------------------------------
alb_enabled = false # Set to true to enable ALB creation

# Uncomment and configure if alb_enabled = true

# Basic ALB Configuration
# alb_internal                       = false  # false = internet-facing, true = internal
# alb_enable_deletion_protection     = false  # Enable in production
# alb_enable_http2                   = true
# alb_enable_cross_zone_load_balancing = true
# alb_idle_timeout                   = 60     # seconds
# alb_drop_invalid_header_fields     = true   # Security best practice

# S3 Access Logs (enabled by default)
# alb_enable_access_logs          = true      # Enable ALB access logs
# alb_create_s3_bucket            = true      # Auto-create S3 bucket
# alb_s3_bucket_prefix            = "alb-logs"
# alb_log_bucket_lifecycle_days   = 90        # Days before transitioning to IA
# alb_log_bucket_expiration_days  = 365       # Days before deletion

# Target Groups - Define your backend targets
# alb_target_groups = [
#   {
#     name        = "web"
#     port        = 80
#     protocol    = "HTTP"
#     target_type = "instance"  # instance, ip, or lambda
#     deregistration_delay = 300
#     health_check = {
#       enabled             = true
#       interval            = 30
#       path                = "/health"
#       port                = "traffic-port"
#       protocol            = "HTTP"
#       timeout             = 5
#       healthy_threshold   = 3
#       unhealthy_threshold = 3
#       matcher             = "200"
#     }
#     stickiness = {
#       enabled         = false
#       type            = "lb_cookie"
#       cookie_duration = 86400
#     }
#   }
# ]

# Listeners - Define how ALB receives traffic
# Example 1: HTTP only
# alb_listeners = [
#   {
#     port     = 80
#     protocol = "HTTP"
#     default_action = {
#       type             = "forward"
#       target_group_key = "web"
#     }
#   }
# ]

# Example 2: HTTPS with HTTP redirect (recommended for production)
# alb_listeners = [
#   {
#     port     = 80
#     protocol = "HTTP"
#     default_action = {
#       type = "redirect"
#       redirect = {
#         protocol    = "HTTPS"
#         port        = "443"
#         status_code = "HTTP_301"
#       }
#     }
#   },
#   {
#     port            = 443
#     protocol        = "HTTPS"
#     certificate_arn = ""  # Use module.acm[0].certificate_arn or provide ARN
#     ssl_policy      = "ELBSecurityPolicy-TLS13-1-2-2021-06"
#     default_action = {
#       type             = "forward"
#       target_group_key = "web"
#     }
#   }
# ]

# Security Group Rules
# alb_security_group_ingress_rules = [
#   {
#     from_port   = 80
#     to_port     = 80
#     protocol    = "tcp"
#     cidr_blocks = ["0.0.0.0/0"]
#     description = "HTTP from anywhere"
#   },
#   {
#     from_port   = 443
#     to_port     = 443
#     protocol    = "tcp"
#     cidr_blocks = ["0.0.0.0/0"]
#     description = "HTTPS from anywhere"
#   }
# ]

# -----------------------------------------------------------------------------
# Example Configurations by Use Case
# -----------------------------------------------------------------------------

# Use Case 1: Development Environment (Cost-Optimized)
# - Single NAT Gateway
# - No VPC Endpoints
# - No Flow Logs
# vpc_enable_nat_gateway = true
# vpc_single_nat_gateway = true
# vpc_enable_flow_logs   = false

# Use Case 2: Production Environment (High Availability)
# - NAT Gateway per AZ
# - VPC Endpoints enabled
# - Flow Logs enabled
# - Database subnets
# vpc_az_count = 3
# vpc_enable_nat_gateway      = true
# vpc_single_nat_gateway      = false
# vpc_one_nat_gateway_per_az  = true
# vpc_enable_flow_logs        = true
# vpc_flow_logs_retention_days = 30
# vpc_enable_s3_endpoint       = true
# vpc_enable_dynamodb_endpoint = true
# vpc_create_database_subnets  = true
# vpc_create_database_subnet_group = true
# vpc_enable_interface_endpoints = {
#   ec2 = true
#   ssm = true
# }

# Use Case 3: Private VPC (No Internet Access)
# - No NAT Gateway
# - VPC Endpoints for AWS services
# - VPN Gateway for on-premises
# vpc_enable_nat_gateway = false
# vpc_enable_vpn_gateway = true
# vpc_enable_s3_endpoint = true
# vpc_enable_interface_endpoints = {
#   ec2 = true
#   ssm = true
#   ssmmessages = true
# }

# -----------------------------------------------------------------------------
# Transit Gateway Configuration
# -----------------------------------------------------------------------------
# tgw_enabled = true

# Basic Configuration
# tgw_description     = "Production Transit Gateway"
# tgw_amazon_side_asn = 64512  # Private ASN for BGP

# Route Table Behavior
# tgw_default_route_table_association = "enable"  # Auto-associate attachments
# tgw_default_route_table_propagation = "enable"  # Auto-propagate routes

# Features
# tgw_dns_support        = "enable"  # DNS resolution across VPCs
# tgw_vpn_ecmp_support   = "enable"  # Equal-cost multipath for VPN
# tgw_multicast_support  = "disable" # Multicast support

# VPC Attachments (Example: Attach current VPC)
# tgw_vpc_attachments = {
#   network-vpc = {
#     vpc_id     = "vpc-xxxxx"  # Use module.vpc.vpc_id or data source
#     subnet_ids = ["subnet-xxxxx", "subnet-yyyyy"]  # Private subnets in multiple AZs
#     dns_support                                     = "enable"
#     appliance_mode_support                          = "disable"
#     transit_gateway_default_route_table_association = true
#     transit_gateway_default_route_table_propagation = true
#   }
# }

# Flow Logs (CloudWatch Logs)
# tgw_enable_flow_logs           = true
# tgw_flow_logs_destination_type = "cloud-watch-logs"
# tgw_flow_logs_retention_days   = 7  # 0, 1, 3, 5, 7, 14, 30, 60, 90, 120, 150, 180, 365, 400, 545, 731, 1827, 3653

# Flow Logs (S3)
# tgw_enable_flow_logs           = true
# tgw_flow_logs_destination_type = "s3"
# tgw_flow_logs_s3_bucket_arn    = "arn:aws:s3:::my-tgw-logs-bucket"

# CloudWatch Alarms
# tgw_enable_cloudwatch_alarms              = true
# tgw_alarm_sns_topic_arn                   = "arn:aws:sns:us-east-1:123456789012:tgw-alarms"
# tgw_bytes_in_threshold                    = 1000000000  # 1 GB
# tgw_bytes_out_threshold                   = 1000000000  # 1 GB
# tgw_packet_drop_count_blackhole_threshold = 1000
# tgw_packet_drop_count_no_route_threshold  = 1000

# Multi-Account Resource Sharing (AWS RAM)
# tgw_enable_resource_sharing        = true
# tgw_ram_allow_external_principals  = false
# tgw_ram_principals = [
#   "arn:aws:organizations::123456789012:organization/o-xxxxx",  # Share with org
#   # OR specific accounts:
#   # "123456789012",
#   # "234567890123"
# ]

# Custom Route Tables (Advanced)
# tgw_create_custom_route_tables = true
# tgw_custom_route_tables = {
#   web-tier = {
#     name = "web-tier"
#   }
#   app-tier = {
#     name = "app-tier"
#   }
#   data-tier = {
#     name = "data-tier"
#   }
# }

# After deployment, view flow logs:
# terraform output transit_gateway_view_flow_logs_command

# -----------------------------------------------------------------------------
# Transit Gateway Cost Estimation
# -----------------------------------------------------------------------------
# Transit Gateway: ~$36/month (hourly charge)
# VPC Attachment:  ~$36/month per VPC
# Data Processing: $0.02/GB
# Flow Logs:       $0.50/GB ingestion + $0.03/GB-month storage (CloudWatch)
#                  $0.023/GB-month (S3)
#
# Example: 1 TGW + 3 VPCs + 1TB data + Flow Logs â‰ˆ $217/month
